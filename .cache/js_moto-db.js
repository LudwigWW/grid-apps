"use strict";var gs_moto_db=exports;!function(){if(self.moto||(self.moto={}),!self.moto.Storage){self.moto.Storage=r;var e=self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB,t=self.IDBKeyRange,n=null;r.delete=function(t){e.deleteDatabase(t)};var i=r.prototype;i.keys=function(e,t,n){var i=[];this.iterate(function(e,t){e&&i.push(e)},t,n,!0),e(i)},i.iterate=function(e,n,i,r){if(!this.db)return this.init(),this.queue.push(["iterate",e,n,i]);var o=n&&i?t.bound(n,i):n?t.lowerBound(n):i?t.upperBound(i):void 0;this.db.transaction(this.name).objectStore(this.name).openCursor(o).onsuccess=function(t){var n=t.target.result;n?(e(n.key,n.value),n.continue()):r&&e(null)}},i.deleteStore=function(){if(this.initCalled)throw"cannot delete ObjectStore after init() called";return this.version=Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,this.init(!0)},i.init=function(t){if(!this.initCalled){var i=this,r=this.name,o=null;try{(o=e.open(r,this.version)).onupgradeneeded=function(e){t?i.db.deleteObjectStore(r):(i.db=o.result,i.store=i.db.createObjectStore(r),e.target.transaction.oncomplete=function(e){i.runQueue()})},o.onsuccess=function(e){i.db=o.result,i.runQueue()},o.onerror=function(e){console.log({error:e}),s()}}catch(e){return void s()}return this.initCalled=!0,this}function s(){console.log("in private browsing mode or browser lacks support for IndexedDB. unable to setup storage for '"+r+"'."),n={},i.runQueue()}},i.runQueue=function(){if(this.queue.length>0){for(var e,t=0,n=this.queue;t<n.length;)switch((e=n[t++])[0]){case"iterate":this.iterate(e[1],e[2],e[3]);break;case"put":this.put(e[1],e[2],e[3]);break;case"get":this.get(e[1],e[2]);break;case"remove":this.remove(e[1],e[2]);break;case"clear":this.clear()}this.queue=[]}},i.put=function(e,t,i){if(n)return n[e]=t,void(i&&i(!0));if(!this.db)return this.init(),this.queue.push(["put",e,t,i]);try{var r=this.db.transaction(this.name,"readwrite").objectStore(this.name).put(t,e);i&&(r.onsuccess=function(e){i(!0)},r.onerror=function(e){i(!1)})}catch(e){console.log(e),i&&i(!1)}},i.get=function(e,t){if(n)t&&t(n[e]);else{if(!this.db)return this.init(),this.queue.push(["get",e,t]);try{var i=this.db.transaction(this.name).objectStore(this.name).get(e);t&&(i.onsuccess=function(e){t(i.result)},i.onerror=function(e){t(null)})}catch(e){console.log(e),t&&t(null)}}},i.remove=function(e,t){if(n)return delete n[e],void(t&&t(!0));if(!this.db)return this.init(),this.queue.push(["remove",e,t]);try{var i=this.db.transaction(this.name,"readwrite").objectStore(this.name).delete(e);t&&(i.onsuccess=function(e){t(!0)},i.onerror=function(e){t(!1)})}catch(e){console.log(e),t&&t(!1)}},i.clear=function(e){if(!this.db)return this.init(),this.queue.push(["clear"]);this.db.transaction(this.name,"readwrite").objectStore(this.name).clear()}}function r(e,t){this.db=null,this.name=e,this.version=t||1,this.queue=[],this.initCalled=!1}}();