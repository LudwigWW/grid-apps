"use strict";let gs_moto_ctrl=exports;var MOTO=window.moto=window.moto||{};MOTO.CTRL=function(e,t,n,o){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.reverseZoom=!1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={UP:38,LEFT:37,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};let a,i,s=this,c=s.domElement,r=new THREE.Vector2,h=new THREE.Vector2,u=new THREE.Vector2,l=new THREE.Vector2,p=new THREE.Vector2,d=new THREE.Vector2,m=new THREE.Vector3,E=new THREE.Vector3,f=new THREE.Vector2,y=new THREE.Vector2,g=new THREE.Vector2,T=0,O=null,b=0,M=null,v=1,P=1,R=new THREE.Vector3,H=new THREE.Vector3,L=new THREE.Quaternion,w=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),A=w.clone().inverse(),x=[],N=!1,k=0,Y={type:"change"},S={type:"start"},D={type:"end"},U={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},V=U.NONE,j=1,X=2,z=3,I=Z(e.fov)?j:Z(e.top)?X:z;function Z(e){return null!=e}function C(e){for(let t=0;t<e.length;t++){let n=e[t];if(Z(n))return n}return null}function _(){return Math.pow(.95,s.zoomSpeed)}function B(e){if(!1===s.enabled)return;e.preventDefault();let t=s.domElement===document?s.domElement.body:s.domElement;if(V===U.ROTATE){if(!0===s.noRotate)return;h.set(e.clientX,e.clientY),u.subVectors(h,r),s.rotateLeft(2*Math.PI*u.x/t.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*u.y/t.clientHeight*s.rotateSpeed),r.copy(h)}else if(V===U.DOLLY){if(!0===s.noZoom)return;y.set(e.clientX,e.clientY),g.subVectors(y,f),g.y>0?s.dollyIn():s.dollyOut(),f.copy(y)}else if(V===U.PAN){if(!0===s.noPan)return;p.set(e.clientX,e.clientY),d.subVectors(p,l),s.pan(d.x,d.y),l.copy(p)}s.update()}function q(e){!1!==s.enabled&&(document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",q,!1),s.dispatchEvent(D),V=U.NONE)}function K(e){if(!1===s.enabled||!0===s.noZoom)return;if(e.preventDefault(),e.stopPropagation(),e.shiftKey&&o)return void o(e.deltaX||e.wheelDelta||e.detail);let t=-(e.deltaY||e.wheelDelta||e.detail||0);if(0===t)return;s.reverseZoom&&(t=-t);let n=s.zoomSpeed;e.ctrlKey&&(s.zoomSpeed*=2),e.metaKey&&(s.zoomSpeed*=2),t>0?s.dollyOut():t<0&&s.dollyIn(),s.zoomSpeed=n,s.update(),s.dispatchEvent(S),s.dispatchEvent(D)}this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.rotateLeft=function(e){T-=e},this.rotateUp=function(e){b-=e},this.panLeft=function(e){let t=this.object.matrix.elements;m.set(t[0],t[1],t[2]),m.multiplyScalar(-e),R.add(m)},this.panUp=function(e){let t=this.object.matrix.elements;m.set(t[4],t[5],t[6]),m.multiplyScalar(e),R.add(m)},this.pan=function(e,t){let n=s.domElement===document?s.domElement.body:s.domElement;switch(I){case j:let o=s.object.position.clone().sub(s.target).length();o*=Math.tan(s.object.fov/2*Math.PI/180),s.panLeft(2*e*o/n.clientHeight),s.panUp(2*t*o/n.clientHeight);break;case X:s.panLeft(e*(s.object.right-s.object.left)/n.clientWidth),s.panUp(t*(s.object.top-s.object.bottom)/n.clientHeight)}},this.setZoom=function(e,t){s.reverseZoom=e,s.zoomSpeed=t||1},this.setPosition=function(e){O=C([e.left,e.theta,O]),M=C([e.up,e.phi,M]),e.panX&&(this.target.x=e.panX),e.panY&&(this.target.y=e.panY),e.panZ&&(this.target.z=e.panZ),e.scale&&(v=e.scale)},this.getPosition=function(e){let t=this.target;return{left:a,up:i,panX:t.x,panY:t.y,panZ:t.z,scale:e?P:1}},this.dollyIn=function(e){void 0===e&&(e=_()),v*=e},this.dollyOut=function(e){void 0===e&&(e=_()),v/=e},this.update=function(){let e=this.object.position;E.copy(e).sub(this.target),E.applyQuaternion(w),a=Z(O)?O:Math.atan2(E.x,E.z),i=Z(M)?M:Math.atan2(Math.sqrt(E.x*E.x+E.z*E.z),E.y),a+=T,i+=b,a=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,a)),i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i)),i=Math.max(1e-6,Math.min(Math.PI-1e-6,i));let t=E.length()*(I===j?v:1);t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(R),E.x=t*Math.sin(i)*Math.sin(a),E.y=t*Math.cos(i),E.z=t*Math.sin(i)*Math.cos(a),E.applyQuaternion(A),e.copy(this.target).add(E),this.object.lookAt(this.target),T=0,O=null,b=0,M=null,R.set(0,0,0),P*=v,I===X?(s.object.zoom=1/v,s.object.updateProjectionMatrix()):v=1,H.distanceToSquared(this.object.position)>1e-6||8*(1-L.dot(this.object.quaternion))>1e-6?(this.dispatchEvent(Y),H.copy(this.object.position),L.copy(this.object.quaternion),n&&n(e,!0)):n&&n(e,!1)},this.reset=function(){V=U.NONE,v=1,P=1,this.target.copy(this.target0),this.object.position.copy(this.position0)},this.getPolarAngle=function(){return i},this.getAzimuthalAngle=function(){return a},this.onMouseUp=q,c.addEventListener("contextmenu",function(e){e.preventDefault()},!1),c.addEventListener("mousedown",function(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.ORBIT:V=e.metaKey?U.PAN:U.ROTATE;break;case s.mouseButtons.ZOOM:V=U.DOLLY;break;case s.mouseButtons.PAN:V=U.PAN}switch(V){case U.ROTATE:if(!0===s.noRotate)return V=U.NONE;r.set(e.clientX,e.clientY);break;case U.DOLLY:if(!0===s.noZoom)return V=U.NONE;f.set(e.clientX,e.clientY);break;case U.PAN:if(!0===s.noPan)return V=U.NONE;l.set(e.clientX,e.clientY)}document.addEventListener("mousemove",B,!1),document.addEventListener("mouseup",q,!1),s.dispatchEvent(S)}},!1),c.addEventListener("mousewheel",K,!1),c.addEventListener("DOMMouseScroll",K,!1),c.addEventListener("touchstart",function(e){if(!1!==s.enabled){switch(e.touches.length){case 1:if(!0===s.noRotate)return;V=U.TOUCH_ROTATE,r.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===s.noZoom)return;V=U.TOUCH_DOLLY;let t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);x=[...e.touches].map(e=>({x:e.pageX,y:e.pageY})),N=!1,k=0,f.set(0,o);break;case 3:if(!0===s.noPan)return;V=U.TOUCH_PAN,l.set(e.touches[0].pageX,e.touches[0].pageY);break;default:V=U.NONE}s.dispatchEvent(S)}},!1),c.addEventListener("touchend",function(){!1!==s.enabled&&(s.dispatchEvent(D),V=U.NONE)},!1),c.addEventListener("touchmove",function(e){if(!1===s.enabled)return;e.preventDefault(),e.stopPropagation();let t=s.domElement===document?s.domElement.body:s.domElement;switch(e.touches.length){case 1:if(!0===s.noRotate)return;if(V!==U.TOUCH_ROTATE)return;h.set(e.touches[0].pageX,e.touches[0].pageY),u.subVectors(h,r),s.rotateLeft(2*Math.PI*u.x/t.clientWidth*s.rotateSpeed),s.rotateUp(2*Math.PI*u.y/t.clientHeight*s.rotateSpeed),r.copy(h),s.update();break;case 2:if(!0===s.noZoom)return;if(V!==U.TOUCH_DOLLY)return;let n=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(n*n+a*a),c=[...e.touches].map(e=>({x:e.pageX,y:e.pageY})),m=(c[0].x-x[0].x+(c[1].x-x[1].x))/2,E=(c[0].y-x[0].y+(c[1].y-x[1].y))/2;s.reverseZoom&&(i=-i),y.set(0,i),g.subVectors(y,f),N||Math.abs(E/m)>10&&o?(N=!0,o(k?k-E:E),k=E):g.y>0?s.dollyOut():s.dollyIn(),f.copy(y),s.update();break;case 3:if(!0===s.noPan)return;if(V!==U.TOUCH_PAN)return;p.set(e.touches[0].pageX,e.touches[0].pageY),d.subVectors(p,l),s.pan(d.x,d.y),l.copy(p),s.update();break;default:V=U.NONE}},!1),window.addEventListener("keydown",function(e){if(!1!==s.enabled&&!0!==s.noKeys&&!0!==s.noPan)switch(e.keyCode){case s.keys.UP:s.pan(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:s.pan(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:s.pan(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:s.pan(-s.keyPanSpeed,0),s.update()}},!1)},MOTO.CTRL.prototype=Object.create(THREE.EventDispatcher.prototype);