"use strict";var gs_base_polygon=exports;!function(){if(self.base||(self.base={}),!self.base.Polygon){var n=self.base,t=n.config,i=n.util,e=(n.debug,n.key),r=Math.sqrt,s=function(){return n.polygons},o=Math.abs,h=Math.min,l=Math.max,u=Math.PI,a=u/180,p=n.Bounds,f=n.newPoint,c=y.prototype,d=(n.newSlope(f(0,0,0,e.NONE),f(1,0,0,e.NONE)),1);n.Polygon=y,n.newPolygon=g,y.filterTooSmall=function(n){return n.length<3?null:n},y.filterTooSkinny=function(n){return n.circularityDeep()*n.areaDeep()<.25?null:n},y.filterArea=function(n){return function(t){return t.area()>=n?t:null}},y.filterDeleted=function(n){return n.delete?null:n},y.filterInside=function(n){return function(t){return n.contains(t)}},y.filterCollect=function(n){return function(t){return n.push(t),t}},y.filterEvolve=function(n){return n.evolve()},y.filterChain=function(n){return t=n,function(n){for(var i=t.length,e=0;e<i&&(n=t[e++](n)););return n};var t},c.toString=function(n){let t;return t=this.inner&&this.inner.length?"/"+this.inner.map(t=>t.toString(n)).join(","):"",n?`P[{${this.area().toFixed(2)}}[${this.points.length}](${this.points.map(n=>`${n.x},${n.y}`).join("|")})${t}]`:`P[${this.points.length,this.area().toFixed(2)}${t}]`},c.alignment=function(){if(this._aligned)return this._aligned;let n={x:!1,y:!1,z:!1},t=void 0;return this.points.forEach(i=>{t&&(n.x=n.x||t.x!==i.x,n.y=n.y||t.y!==i.y,n.z=n.z||t.z!==i.z),t=i}),this._aligned=!1===n.x?"yz":!1===n.y?"xz":"xy"},c.ensureXY=function(){if(this._swapped)return this;switch(this.alignment()){case"xy":break;case"yz":this.swap(!0,!1)._swapped=!0;break;case"xz":this.swap(!1,!0)._swapped=!0;break;default:throw"invalid alignment"}return this},c.restoreXY=function(){if(!this._swapped)return this;switch(this.alignment()){case"xy":break;case"yz":this.swap(!0,!1)._swapped=!1;break;case"xz":this.swap(!1,!0)._swapped=!1}return this},c.earcut=function(){let n=[],t=[];this.points.forEach(t=>{n.push(t.x,t.y,t.z)}),this.inner&&this.inner.forEach(i=>{t.push(n.length/3),i.points.forEach(t=>{n.push(t.x,t.y,t.z)})});let i=earcut(n,t,3),e=[];for(let t=0;t<i.length;t+=3){let r=new y;r._aligned=this._aligned,r._swapped=this._swapped;for(let e=0;e<3;e++){let s=3*i[t+e];r.add(n[s],n[s+1],n[s+2])}e.push(r)}return e},c.createConvexHull=function(n){n.sort(function(n,t){return n.x!=t.x?n.x-t.x:n.y-t.y});for(var t,i,e,r,s,o=n.length,h=[],l=0;l<2*o;l++){for(var u=l<o?l:2*o-1-l;h.length>=2&&(t=h[h.length-2],i=h[h.length-1],e=n[u],void 0,void 0,r=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),s=(t.x-i.x)*(e.x-i.x)+(t.y-i.y)*(e.y-i.y),r<0||0==r&&s<=0);)h.pop();h.push(n[u])}return h.pop(),this.addPoints(h),this},c.stepsFromRoot=function(){for(var n=this.parent,t=0;n;)n.inner&&n.inner.length>1&&t++,n=n.parent;return t},c.first=function(){return this.points[0]},c.last=function(){return this.points[this.length-1]},c.swap=function(n,t){var i=this.points,e=i.length;this.bounds=new p;for(var r=0;r<e;r++){let e=i[r];n?e.swapXZ():t&&e.swapYZ(),this.bounds.update(e)}return this.inner&&this.inner.forEach(function(i){i.swap(n,t)}),this},c.average=function(){let n=f(0,0,0,null);return this.points.forEach(t=>{n.x+=t.x,n.y+=t.y,n.z+=t.z}),n.x/=this.points.length,n.y/=this.points.length,n.z/=this.points.length,n},c.center=function(n){var t=f(0,0,0,null),i=g(),e=this.points;return e.forEach(function(n){t.x+=n.x,t.y+=n.y,t.z+=n.z}),t.x/=e.length,t.y/=e.length,t.z/=e.length,n?t:(e.forEach(function(n){i.push(f(n.x-t.x,n.y-t.y,n.z-t.z))}),i)},c.circleCenter=function(){var n=this.points,t=n.length,i=Math.floor(t/3),e=n[0],r=n[i],s=n[2*i],o=(r.y-e.y)/(r.x-e.x),h=(s.y-r.y)/(s.x-r.x),l=f(0,0,0,null);return l.x=(o*h*(e.y-s.y)+h*(e.x+r.x)-o*(r.x+s.x))/(2*(h-o)),l.y=-1*(l.x-(e.x+r.x)/2)/o+(e.y+r.y)/2,l.z=e.z,l},c.centerRectangle=function(n,t,i){return t/=2,i/=2,this.push(f(n.x-t,n.y-i,n.z)),this.push(f(n.x+t,n.y-i,n.z)),this.push(f(n.x+t,n.y+i,n.z)),this.push(f(n.x-t,n.y+i,n.z)),this},c.centerSpiral=function(n,t,i,e,r){r*=4,e/=2;let s,o={x:n.x-t/2,y:n.y+i/2,z:n.z},h={x:1,y:0,i:0};for(;r-- >0;){switch(this.push(f(o.x,o.y,o.z)),o.x+=h.x*t,o.y+=h.y*i,h.i++){case 0:s=h.x,h.x=h.y,h.y=-s;break;case 1:s=h.x,h.x=h.y,h.y=s;break;case 2:s=h.x,h.x=h.y,h.y=-s;break;case 3:s=h.x,h.x=h.y,h.y=s}t-=e/2,i-=e/2,h.i=h.i%4}return this},c.centerCircle=function(n,t,e,r){var s=0,o=360/e;for(r&&(o=-o);e-- >0;)this.push(f(i.round(Math.cos(s*a)*t,7)+n.x,i.round(Math.sin(s*a)*t,7)+n.y,n.z)),s+=o;return this},c.move=function(n){var t=this.bounds=new p;return this.points.forEach(function(i){i.move(n),t.update(i)}),this.inner&&this.inner.forEach(function(t){t.move(n)}),this},c.scale=function(n,t){var e=this.bounds=new p;this.points.forEach(function(r){r.x*=n,r.y*=n,r.z*=n,t&&(r.x=i.round(r.x,t),r.y=i.round(r.y,t),r.z=i.round(r.z,t)),e.update(r)}),this.inner&&this.inner.forEach(function(i){i.scale(n,t)})},c.hintFillAngle=function(){for(var n,i,e,r,s=0,o=this.points,h=o.length,l=t.hint_min_circ,u=t.hint_len_min,a=t.hint_len_max||1/0;s<h;)n=o[s],i=o[++s%h],(e=n.distToSq2D(i))>=u&&e<=a&&(!r||e>r.len)&&(r={p1:n,p2:i,len:e});return r&&this.circularity()>=l&&(this.fillang=r.p1.slopeTo(r.p2).normal()),this.fillang},c.clone=function(n){for(var t=g(),i=this.length,e=0;e<i;)t.push(this.points[e++]);return t.fillang=this.fillang,t.depth=this.depth,t.open=this.open,n&&this.inner&&(t.inner=this.inner.clone()),t},c.setZ=function(n){for(var t=this.points,i=t.length,e=0;e<i;)t[e++].z=n;return this.inner&&this.inner.forEach(function(t){t.setZ(n)}),this},c.getZ=function(){return this.points[0].z},c.render=function(n,t,i,e){n.poly(this,t,i,e)},c.renderSolid=function(n,t){n.solid(this,t)},c.add=function(n,t,i){return this.push(f(n,t,i)),this},c.addPoints=function(n){for(var t=n.length,i=0;i<t;)this.push(n[i++]);return this},c.push=function(n){return n.poly&&(n=n.clone()),n.poly=this,this.length++,this.points.push(n),this.bounds.update(n),n},c.append=function(n){return this.push(n),this},c.setClosed=function(){return this.open=!1,this},c.setOpen=function(){return this.open=!0,this},c.isOpen=function(){return this.open},c.isClosed=function(){return!this.open},c.setClockwise=function(){return this.isClockwise()||this.reverse(),this},c.setCounterClockwise=function(){return this.isClockwise()&&this.reverse(),this},c.isClockwise=function(){return this.area(!0)>0},c.showKey=function(){return[this.first().key,this.last().key,this.length].join("~~")},c.alignWinding=function(n,t){t&&this.length>n.length?n.alignWinding(this,!1):this.isClockwise()!==n.isClockwise()&&this.reverse()},c.opposeWinding=function(n,t){t&&this.length>n.length?n.opposeWinding(this,!1):this.isClockwise()===n.isClockwise()&&this.reverse()},c.reverse=function(){return this.area2=-this.area2,this.points=this.points.reverse(),this},c.isNested=function(n){return!!n.bounds.contains(this.bounds)&&this.isInside(n,t.precision_nested_sq)},c.forEachPointEaseDown=function(n,t){for(var i,e,r,s=this.findClosestPointTo(t).index,o=t.z,h=0,l=this.points,u=l.length,a=-1,p=l[0].z;;){if(r=l[s%u],e&&r.z<o){var f=o-r.z;(i=e.distTo2D(r))>2*f?n(e.followTo(r,f).setZ(r.z),h++):i>=f||(r=r.clone().setZ(o-i/2)),o=r.z}else 0===h&&r.z<o&&(r=r.clone().setZ(o));if(e=r,n(r,h++),s%u===a)break;a<0&&r.z<=p&&(a=s%u),s++}return e},c.forEachPoint=function(n,t,i){for(var e,r=i||0,s=this.points,o=s.length,h=t?o+1:o,l=0;h-- >0;){if(n(s[e=r%o],e,s,l++))return;r++}},c.forEachSegment=function(n,t,i){for(var e,r,s=i||0,o=this.points,h=o.length,l=t?h-1:h;l-- >0;){if(r=(s+1)%h,n(o[e=s%h],o[r],e,r))return;s++}},c.intersections=function(t,e){var r=[];return this.forEachSegment(function(s,o,h,l){var u=i.intersect(t,e,s,o,n.key.SEGINT,!1);u&&(r.push(u),s.pos=h,o.pos=l)}),r.sort(function(n,e){return i.distSq(t,n)-i.distSq(t,e)}),r},c.bisect=function(n,t){if(this.isOpen())return null;var i=this.clone().setClockwise(),e=i.intersections(n,t);return e&&2===e.length?[i.emitSegment(e[0],e[1]),i.emitSegment(e[1],e[0]).reverse()]:null},c.emitSegment=function(n,t){var i=g(),e=n.p2.pos;t.p1.pos;return i.setOpen(),i.push(n),this.forEachPoint(function(n,e){if(i.push(n),n===t.p1)return!0},!0,e),i.push(t),i},c.hasPointsInside=function(n,i){if(!n.overlaps(this))return!1;var e,r=!1;return this.forEachSegment(function(s,o){return s.distTo2D(o)>t.precision_midpoint_check_dist&&((e=s.midPointTo(o)).inPolygon(n)||e.nearPolygon(n,i||t.precision_close_to_poly_sq))?r=!0:o.inPolygon(n)||o.nearPolygon(n,i||t.precision_close_to_poly_sq)?r=!0:void 0}),r},c.isInside=function(n,i){if(!this.bounds.isNested(n.bounds))return!1;var e,r=!0;return this.forEachSegment(function(s,o){return s.distTo2D(o)>t.precision_midpoint_check_dist&&!(e=s.midPointTo(o)).inPolygon(n)&&!e.nearPolygon(n,i||t.precision_close_to_poly_sq)?(r=!1,!0):o.inPolygon(n)||o.nearPolygon(n,i||t.precision_close_to_poly_sq)?void 0:(r=!1,!0)}),r},c.contains=function(n,t){return n&&n.isInside(this,t)&&n.isOutsideAll(this.inner,t)},c.containedBySet=function(n){if(!n)return!1;for(var t=0;t<n.length;t++)if(n[t].contains(this))return!0;return!1},c.addInner=function(n){return n.parent=this,this.inner?this.inner.push(n):this.inner=[n],this},c.innerCount=function(){return this.inner?this.inner.length:0},c.hasInner=function(){return this.inner&&this.inner.length>0},c.clearInner=function(){return this.inner=null,this},c.newUndeleted=function(){var n=g();return this.forEachPoint(function(t){t.del||n.push(t)}),n},c.circularity=function(){return 4*u*this.area()/i.sqr(this.perimeter())},c.circularityDeep=function(){return 4*u*this.areaDeep()/i.sqr(this.perimeter())},c.perimeter=function(){if(0!==this.perim)return this.perim;var n=0;return this.forEachSegment(function(t,i){n+=r(t.distToSq2D(i))},this.open),this.perim=n},c.perimeterDeep=function(){var n=this.perimeter();return this.inner&&this.inner.forEach(function(t){n+=t.perimeter()}),n},c.area=function(n){if(this.length<3)return 0;if(0===this.area2)for(var t,i,e=this.points,r=e.length,s=0;s<r;s++)t=e[s],i=e[(s+1)%r],this.area2+=(i.x-t.x)*(i.y+t.y);return n?this.area2:o(this.area2/2)},c.areaDeep=function(){if(!this.inner)return this.area();var n,t=this.inner,i=this.area();for(n=0;n<t.length;n++)i-=t[n].area();return i},c.overlaps=function(n){return this.bounds.overlaps(n.bounds,t.precision_merge)},c.fromXYArray=function(n,t){for(var i=0;i<n.length;)this.add(n[i++],n[i++],t||0);return this},c.clean=function(n,i){let e=function(n,t){for(var i=g(),e=0,r=n.length;e<r;)i.push(f(null,null,t,null,n[e++]));return i}(self.ClipperLib.Clipper.CleanPolygon(this.toClipper()[0],t.clipperClean),this.getZ());return n&&this.inner&&(e.inner=this.inner.map(n=>n.clean(!1,e))),e.parent=i||this.parent,e.area2=this.area2,e||this},c.toClipper=function(n,t){var i=n||[];if(t){for(var e,r=[],s=this.points,o=s.length,h=0;h<o;)e=s[h++],r.push({X:e.x,Y:e.y});i.push(r)}else i.push(this.points);return this.inner&&this.inner.forEach(function(n){n.toClipper(i,t)}),i},c.offset=function(n,t){return s().expand([this],-n,this.getZ(),t)},c.isEquivalent=function(n,e,r){if(i.isCloseTo(this.area(),n.area(),r||t.precision_poly_area)&&this.bounds.equals(n.bounds,r||t.precision_poly_bounds)){var s=this.circularity(),h=n.circularity();if(o(s-h)<t.precision_circularity&&1-s<t.precision_circularity)return!0;if(e){var l,u=this.inner,a=n.inner;if(u!==a){if(null===u||null===a||u.length!=a.length)return!1;for(l=0;l<u.length;l++)if(!u[l].isEquivalent(a[l]))return!1}}var p,f,c,d=!0;return this.forEachPoint(function(i){if(p=!1,n.forEachSegment(function(n,e){if((f=i.distToLine(n,e))<t.precision_poly_merge)return p=!0;c=Math.min(c,f)}),!p)return d=!1,!0}),d}return!1},c.findClosestPointTo=function(n){var t,i,e,s=1/0;return this.forEachPoint(function(o,h){(t=r(o.distToSq2D(n)))<s&&(i=h,s=t,e=o)}),{point:e,distance:s,index:i}},c.flattenTo=function(n){return n.push(this),this.inner&&n.appendAll(this.inner),n},c.shortestSegmentLength=function(){var n=1/0;return this.forEachSegment(function(t,i){n=Math.min(n,t.distTo2D(i))}),n},c.diff=function(n){var t=this.fillang&&this.area()>n.area()?this.fillang:n.fillang,i=self.ClipperLib,e=i.ClipType,r=i.PolyType,o=i.PolyFillType,h=new i.Clipper,l=new i.PolyTree,u=this.toClipper(),a=n.toClipper();return h.AddPaths(u,r.ptSubject,!0),h.AddPaths(a,r.ptClip,!0),h.Execute(e.ctDifference,l,o.pftEvenOdd,o.pftEvenOdd)?((n=s().fromClipperTree(l,n.getZ())).forEach(function(n){n.fillang=t}),n):null},c.mask=function(n){var t=this.fillang&&this.area()>n.area()?this.fillang:n.fillang,i=self.ClipperLib,e=i.ClipType,r=i.PolyType,o=i.PolyFillType,h=new i.Clipper,l=new i.PolyTree,u=this.toClipper(),a=n.toClipper();return h.AddPaths(u,r.ptSubject,!0),h.AddPaths(a,r.ptClip,!0),h.Execute(e.ctIntersection,l,o.pftEvenOdd,o.pftEvenOdd)?((n=s().fromClipperTree(l,n.getZ())).forEach(function(n){n.fillang=t}),n):null},c.union=function(n,t){if(!this.overlaps(n))return null;var i=this.fillang&&this.area()>n.area()?this.fillang:n.fillang,e=self.ClipperLib,r=e.ClipType,o=e.PolyType,h=e.PolyFillType,l=new e.Clipper,u=new e.PolyTree,a=this.toClipper(),p=n.toClipper(),f=t>=0?t:.1;if(l.AddPaths(a,o.ptSubject,!0),l.AddPaths(p,o.ptClip,!0),l.Execute(r.ctUnion,u,h.pftEvenOdd,h.pftEvenOdd)){let t=s().fromClipperTreeUnion(u,n.getZ(),f);if(1===t.length)return(t=t[0]).fillang=i,t}return null},c.spread=function(){var n,t,i,e,r,s,u,a,p,f=this.points,c=f.length;for(u={d:0},p=0,n=0;n<c;n++)t=f[n%c],i=f[(n+1)%c],e=o(t.x-i.x)+o(t.y-i.y),r=o(e-u.d),s=e>p,p=l(p,e),(s||r<.001&&u.p1&&h(t.z,i.z)<h(u.p1.z,u.p2.z))&&(u={p1:t,p2:i,i:(n+1)%c,d:e});return u.i>0?((a=f.slice(u.i)).appendAll(f.slice(0,u.i)),g(a)):this}}function y(n){this.id=d++,this.open=!1,this.length=0,this.points=[],this.area2=0,this.perim=0,this.bounds=new p,this.inner=null,this.parent=null,this.depth=0,this.delete=!1,this.fillang=null,this.fills=null,n&&this.addPoints(n)}function g(n){return new y(n)}}();