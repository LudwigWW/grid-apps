"use strict";var gs_kiri_codec=exports;!function(){if(self.kiri||(self.kiri={}),!self.kiri.codec){var e=self.base,r=self.kiri,t={};r.codec={encode:n,decode:i,registerDecoder:s},r.Slice.prototype.encode=function(e){return{type:"slice",z:this.z,index:this.index,camMode:this.camMode,tops:n(this.tops,e),bridges:n(this.bridges,e),flats:n(this.flats,e),solids:n(this.solids,e),supports:n(this.supports,e)}},s("slice",function(e,t){var n=r.newSlice(e.z,t.mesh?t.mesh.newGroup():null);return n.index=e.index,n.camMode=e.camMode,n.tops=i(e.tops,t),n.bridges=i(e.bridges,t),n.flats=i(e.flats,t),n.solids=i(e.solids,t),n.supports=i(e.supports,t),n}),r.Top.prototype.encode=function(e){return{type:"top",poly:n(this.poly,e),traces:n(this.traces,e),inner:n(this.inner,e),solids:n(this.solids,e),fill_lines:o(this.fill_lines,e),fill_sparse:n(this.fill_sparse,e),polish:n(this.polish,e)}},s("top",function(e,t){var n=r.newTop(i(e.poly,t));return n.traces=i(e.traces,t),n.inner=i(e.inner,t),n.solids=i(e.solids,t),n.fill_lines=l(e.fill_lines),n.fill_sparse=i(e.fill_sparse,t),n.polish=i(e.polish,t),n}),e.Polygon.prototype.encode=function(e){return e.poly||(e.poly={}),e.poly[this.id]?{type:"poly",ref:this.id}:(e.poly[this.id]=this,{type:"poly",id:this.id,array:o(this.points,e),open:this.isOpen(),inner:n(this.inner,e),parent:n(this.parent,e),fills:o(this.fills,e),depth:this.depth})},s("poly",function(r,t){if(t.poly||(t.poly={}),r.ref)return t.poly[r.ref];for(var n=e.newPolygon(),s=0;s<r.array.length;)n.push(e.newPoint(r.array[s++],r.array[s++],r.array[s++]));return n.id=r.id,n.open=r.open,t.poly[r.id]=n,n.inner=i(r.inner,t),n.parent=i(r.parent,t),n.fills=l(r.fills),n.depth=r.depth,n})}function n(e,r){if(r=r||{},null===e)return null;if(void 0!==e){if(Array.isArray(e)){for(var t=new Array(e.length),i=0;i<e.length;)t[i]=n(e[i++],r);return t}switch(typeof e){case"string":case"number":return e;case"object":return e.encode?e.encode(r):function(e,r){if(e instanceof Float32Array)return e;var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=n(e[i],r));return t}(e,r)}return null}}function i(e,r){if(r=r||{},null===e)return null;if(void 0!==e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)e[n]=i(e[n],r);return e}switch(typeof e){case"string":case"number":return e;case"object":return e.type&&t[e.type]?t[e.type](e,r):function(e,r){if(e instanceof Float32Array)return e;var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=i(e[n],r));return t}(e,r)}return null}}function s(e,r){t[e]=r}function o(e,r){if(!e)return null;var t=new Float32Array(3*e.length),n=0;return e.forEach(function(e){if(r.rotate){r.centerz&&(e.z-=r.centerz);let t=new THREE.Vector3(e.x,e.y,e.z);t.applyMatrix4(r.rotate),e={x:t.x,y:t.y,z:t.z},r.centerz&&(e.z+=r.centerz),r.movez&&(e.z-=r.movez)}t[n++]=e.x,t[n++]=e.y,t[n++]=e.z}),t}function l(r){if(!r)return null;for(var t=0,n=0,i=new Array(r.length/3);t<r.length;)i[n++]=e.newPoint(r[t++],r[t++],r[t++]);return i}}();